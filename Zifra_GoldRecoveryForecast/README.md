# Восстановление золота из руды

Подготовьте прототип модели машинного обучения для «Цифры». Компания разрабатывает решения для эффективной работы промышленных предприятий.

Модель должна предсказать коэффициент восстановления золота из золотосодержащей руды. Используйте данные с параметрами добычи и очистки.

Модель поможет оптимизировать производство, чтобы не запускать предприятие с убыточными характеристиками.

Технологический процесс
Как золото получают из руды? Изучите внимательно стадии процесса.
Когда добытая руда проходит первичную обработку, получается дроблёная смесь. Её отправляют на флотацию (обогащение) и двухэтапную очистку.

Опишем каждую стадию: 
1. Флотация
Во флотационную установку подаётся смесь золотосодержащей руды. После обогащения получается черновой концентрат и «отвальные хвосты», то есть остатки продукта с низкой концентрацией ценных металлов.
На стабильность этого процесса влияет непостоянное и неоптимальное физико-химическое состояние флотационной пульпы (смеси твёрдых частиц и жидкости).
2. Очистка 
Черновой концентрат проходит две очистки. На выходе получается финальный концентрат и новые отвальные хвосты.
Описание данных

Технологический процесс:
-	Rougher feed — исходное сырье
-	Rougher additions (или reagent additions) — флотационные реагенты: Xanthate, Sulphate, Depressant 
-	Xanthate — ксантогенат (промотер, или активатор флотации);
-	Sulphate — сульфат (на данном производстве сульфид натрия);
-	Depressant — депрессант (силикат натрия).
-	Rougher process (англ. «грубый процесс») — флотация
-	Rougher tails — отвальные хвосты
-	Float banks — флотационная установка
-	Cleaner process — очистка
-	Rougher Au — черновой концентрат золота
-	Final Au — финальный концентрат золота

Параметры этапов:
-	air amount — объём воздуха
-	fluid levels — уровень жидкости
-	feed size — размер гранул сырья
-	feed rate — скорость подачи

Наименование признаков:
Наименование признаков должно быть такое: [этап].[тип_параметра].[название_параметра]
Пример: rougher.input.feed_ag

Возможные значения для блока [этап]:
•	rougher — флотация
•	primary_cleaner — первичная очистка
•	secondary_cleaner — вторичная очистка
•	final — финальные характеристики

Возможные значения для блока [тип_параметра]:
•	input — параметры сырья
•	output — параметры продукта
•	state — параметры, характеризующие текущее состояние этапа
•	calculation — расчётные характеристики

Расчёт эффективности:
Вам нужно смоделировать процесс восстановления золота из золотосодержащей руды.
Эффективность обогащения рассчитывается по формуле: Cx(F-T) / Fx(C-T) x 100
где:
•	C — доля золота в концентрате после флотации/очистки;
•	F — доля золота в сырье/концентрате до флотации/очистки;
•	T — доля золота в отвальных хвостах после флотации/очистки.

Для решения задачи введём новую метрику качества —
sMAPE (англ. Symmetric Mean Absolute Percentage Error, «симметричное среднее абсолютное процентное отклонение»).

Нужно спрогнозировать сразу две величины:
1.	эффективность обогащения чернового концентрата rougher.output.recovery;
2.	эффективность обогащения финального концентрата final.output.recovery.
Итоговая метрика складывается из двух величин: 0.25 x sMAPE(rougher) + 0.75 x sMAPE(final)

**Выводы по проекту:**

- 1.1.  Загрузили и изучили основные характеристики выборок;
- 1.2.  Проверили, правильно ли рассчитана эффективность обогащения золота. Написалим собственную функцию для расчета эффективности обогащения и сравнили результаты ее работы с значениями из фрейма. Ошибка очень мала, поэтому считаем, что эффективность обогащения на этапе флотации в обучающей выборке расчитаны верно;
- 1.3.  В тестовой выборке отсутствуют выходные данные по всем составляющим, т.е. отсутствуют данные о содержании составляющих и в концентратах, и в хвостах как для промежуточных этапов, так и для финальной стадии. Соответственнно не рассчитана и эффективность обогащения как по этапам, так и итоговая. Также в тестовой выборке отсутствуют расчетные столбцы. Все отстутствующие данные числовые;
- 1.4. Заполнили пропуки во всех выборках предыдущими ненулевыми значениями из соответствующих столбцов;
- 2.1.  Выяснили как меняется концентрация металлов (Au, Ag, Pb) на различных этапах:
Концентрация золота от стадии к стадии растет - это и есть цель технологического процесса. Концентрация серебра растет на стадии флотации, однако дальнейшая очистка уменьшает его концентрацию до значений меньше исходных, вероятно основная часть серебра уходит в хвосты. Концентрация свинца также растет на стадиях флотации и первичной очистки, однако вторичная очистка ее повышает незначительно;
- 2.2.  Распределения размеров гранул исходного сырья на обучающей и тестовой выборках несильно отличаются друг от друга, оценка модели будет нормальной.
- 2.3.  Суммарная концентрация металлов растет после флотации и падает после первичной очистки (скорее всего из-за ухода серебра в хвосты и снова возрастает после вторичной очистки. В какие-то моменты времени суммарная концентрации на каждой отдельной стадии равна нулю, возможно в эти моменты проходила несодержащая металлов пустая порода;
- 3.1.  Написали функцию для вычисления итоговой sMAPE;
3.2. Провели обучение 5-ти видов моделей и получили лучший результаты итоговой метрики на кросс-валидации для модели случайного леса;
3.3. Проверили модель с лучшими результатами на кросс-валидации на тестовой выборке и получили лучшее итоговое значение метрики равное 5,67. Проверили модель на адекватность при помощи константной модели с предсказанием по среднему. Наша лучшая модель показывет sMape почти на 1 меньше, чем константная модель.
